<!DOCTYPE html>
<html lang="en">
<head>
    <th:block th:insert="~{blocks/head :: head}"></th:block>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.18.3/bootstrap-table.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.18.3/bootstrap-table.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.20.0/dist/bootstrap-table.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.18.3/extensions/addrbar/bootstrap-table-addrbar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table/dist/bootstrap-table.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
    <style>
        .form-control {
            border-radius: 10px;
        }
    </style>
</head>

<body>
<header th:replace="~{blocks/header :: header}"></header>

<div class="container mt-5">
    <!-- User Profile Card -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0" th:text="${user.getFullName}"></h3>
            <p class="mb-0" th:text="'@' + ${user.getUsername}"></p>
        </div>
        <div class="card-body">
            <h5 class="card-title">Персональная информация</h5>
            <p class="card-text">Полное имя: <span th:text="${user.getFullName}" class="font-weight-bold"></span></p>
            <p class="card-text">Почта: <span th:text="${user.getEmail}" class="font-weight-bold"></span></p>
            <p class="card-text">Дата регистрации: <span th:text="${user.getCreatedAt}" class="font-weight-bold"></span>
            </p>
        </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mt-4">
        <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#cards">Карты</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#transfers">Переводы</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#transactions">История</a>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content mt-3">
        <!-- Cards Tab -->
        <div id="cards" class="tab-pane fade show active">
            <div class="row" th:unless="${userAccounts}">
                <div class="col">
                    <p>Карты отсутствуют</p>
                </div>
            </div>

            <div class="row" th:if="${userAccounts}">
                <div class="col-md-4" th:each="account : ${userAccounts}">
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">
                                <span th:text="${account.getCard.getName}"></span>
                                <small class="text-muted font-italic"
                                       th:text="' (' + ${account.getAccountNumber} + ')'"></small>
                            </h5>
                            <p class="card-text">Номер карты: <span class="card-number font-weight-bold"
                                                                    th:text="${account.getCard.getCardNumber}"></span>
                            </p>
                            <p class="card-text">Баланс: <span class="card-balance font-weight-bold"
                                                               th:text="${account.getBalance} + ' ' + ${account.getCurrency}"></span>
                            </p>
                            <button th:id="'toggle-button-card-' + ${account.getCard.getId}"
                                    class="btn btn-link toggle-button-card">
                                <i class="fas fa-eye-slash"></i> Скрыть
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transfers Tab -->
        <div id="transfers" class="tab-pane fade">
            <div class="mt-3">
                <h5>Перевод средств</h5>
                <form method="post" th:action="@{/transfer-money}" id="transferForm">
                    <div class="form-group">
                        <label for="recipient">Имя получателя</label>
                        <input type="text" class="form-control transfer-input" id="recipient" name="recipient"
                               placeholder="medlcago">
                        <small class="invalid-feedback" id="recipientError"></small>
                    </div>
                    <div class="form-group">
                        <label for="amount">Сумма</label>
                        <div class="input-group">
                            <input type="number" step="any" class="form-control transfer-input" id="amount"
                                   name="amount" min="1"
                                   max="100000" placeholder="500">
                            <div class="input-group-append">
                                <select class="custom-select" id="currency" name="currency">
                                    <option th:each="account : ${userAccounts}" th:name="${account.getCurrency}"
                                            th:text="${account.getCurrency}"></option>
                                </select>
                            </div>
                            <small class="invalid-feedback" id="amountError"></small>
                        </div>
                    </div>
                    <div id="successTransferAlert" class="alert alert-success text-center" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary">Перевести</button>
                </form>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions" class="tab-pane fade">
            <style>
                /* Стилизация выпадающего списка */
                .bootstrap-table .filter-control {
                    width: 100%;
                    padding: 6px;
                    background-color: #fff;
                }

                /* Перенастройка разметки фильтра */
                .bootstrap-table .fixed-table-container .fixed-table-body th[data-field="type"] {
                    position: relative;
                }

                .bootstrap-table .fixed-table-container .fixed-table-body th[data-field="type"] .filter-control {
                    position: absolute;
                    top: 0;
                    right: 0;
                    margin: 5px;
                }
            </style>

            <table id="transaction-table" data-pagination="true" data-page-size="10"
                   data-toggle="table" data-sortable="true"
                   data-classes="table table-striped table-hover" data-search-field="code" data-addrbar="true"
                   data-filter-control="true" data-alignment-select-control-options="auto">
                <thead>
                <tr>
                    <th data-field="id" data-sortable="true">№</th>
                    <th data-field="sender">Отправитель</th>
                    <th data-field="receiver">Получатель</th>
                    <th data-field="amount" data-sortable="true">Сумма</th>
                    <th data-field="currency">Валюта</th>
                    <th data-field="type" data-filter-control="select" data-filter-control-placeholder="Тип">Тип</th>
                    <th data-field="date">Дата</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script type="text/javascript" th:src="@{js/card-toggler.js}"></script>
<script type="text/javascript" th:src="@{js/transfer-funds.js}"></script>

</body>
</html>
